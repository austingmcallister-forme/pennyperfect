"use strict";(()=>{var e={};e.id=476,e.ids=[476],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2954:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>c,originalPathname:()=>w,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var t={};o.r(t),o.d(t,{POST:()=>POST});var s=o(884),a=o(6132),i=o(5798),n=o(7542),d=o(7677);async function POST(e){try{let r=e.headers.get("x-shopify-hmac-sha256"),o=await e.text();if(!r||!await (0,d.kL)(o,r))return i.Z.json({error:"Invalid HMAC"},{status:401});let t=JSON.parse(o),s=e.headers.get("x-shopify-shop-domain");if(!s)return i.Z.json({error:"Shop domain not found"},{status:400});let a=await n._.shop.findUnique({where:{domain:s}});if(!a)return i.Z.json({error:"Shop not found"},{status:404});let p=await n._.experiment.findMany({where:{shopId:a.id,status:"running"},include:{periods:{where:{endedAt:null}}}}),u=Math.round(100*parseFloat(t.total_price));for(let e of p)for(let r of e.periods)await n._.experimentPeriod.update({where:{id:r.id},data:{orders:r.orders+1,revenueCents:BigInt(Number(r.revenueCents)+u)}});return i.Z.json({message:"Order processed"})}catch(e){return console.error("Error processing order webhook:",e),i.Z.json({error:"Failed to process order"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/orders/paid/route",pathname:"/api/webhooks/orders/paid",filename:"route",bundlePath:"app/api/webhooks/orders/paid/route"},resolvedPagePath:"/Users/austinmcallister/pennyperfect/src/app/api/webhooks/orders/paid/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:h,headerHooks:c,staticGenerationBailout:m}=p,w="/api/webhooks/orders/paid/route"},7542:(e,r,o)=>{o.d(r,{_:()=>a});let t=require("@prisma/client"),s=globalThis,a=s.prisma??new t.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[997,543,677],()=>__webpack_exec__(2954));module.exports=o})();